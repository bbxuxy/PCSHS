<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCSHS Dream - Study Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background: #f4f7f6; }
        .subject-card { transition: transform 0.2s, box-shadow 0.2s; border-radius: 20px; }
        .subject-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .nav-active { color: #7c3aed; border-bottom: 3px solid #7c3aed; }
    </style>
</head>
<body>

<div id="loginPage" class="fixed inset-0 flex flex-col items-center justify-center bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 z-50">
    <h1 class="text-7xl font-bold text-white mb-8 tracking-widest animate-pulse">Welcome</h1>
    <div class="bg-white/20 backdrop-blur-md p-8 rounded-3xl shadow-2xl w-80 text-center border border-white/30">
        <input type="password" id="passInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (DDMMYYYY)" 
               class="w-full p-4 rounded-2xl mb-4 text-center text-xl outline-none focus:ring-4 focus:ring-white/50 bg-white/90">
        <button onclick="checkLogin()" 
                class="w-full bg-white text-purple-600 py-4 rounded-2xl font-bold text-lg hover:bg-purple-50 transition-all active:scale-95">
            UNLOCK DREAM
        </button>
    </div>
</div>

<div id="appContent" class="hidden min-h-screen">
    <nav class="bg-white sticky top-0 z-40 shadow-sm">
        <div class="flex justify-around items-center h-16 max-w-2xl mx-auto px-4">
            <button onclick="showPage('home')" id="btn-home" class="nav-active px-2 py-1 font-semibold">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            <button onclick="showPage('history')" id="btn-history" class="px-2 py-1 font-semibold text-gray-400">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</button>
            <button onclick="showPage('stats')" id="btn-stats" class="px-2 py-1 font-semibold text-gray-400">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>
        </div>
    </nav>

    <main id="homePage" class="p-6 max-w-4xl mx-auto">
        <div class="bg-white p-6 rounded-[2rem] shadow-sm mb-10 border border-gray-100">
            <h2 class="text-xl font-bold mb-6 text-gray-800 flex items-center">
                <span class="mr-2">üìà</span> ‡∏Å‡∏£‡∏≤‡∏ü‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
            </h2>
            <div class="h-64">
                <canvas id="growthChart"></canvas>
            </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
            <button onclick="openModal('‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå')" class="subject-card p-10 bg-blue-50 text-blue-600 border-2 border-blue-100 font-bold text-xl">
                ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå
            </button>
            <button onclick="openModal('‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå')" class="subject-card p-10 bg-rose-50 text-rose-600 border-2 border-rose-100 font-bold text-xl">
                ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå
            </button>
            <button onclick="openModal('‡∏ß‡∏¥‡∏ä‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ')" class="subject-card p-10 bg-emerald-50 text-emerald-600 border-2 border-emerald-100 font-bold text-xl">
                ‡∏ß‡∏¥‡∏ä‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ
            </button>
        </div>
    </main>

    <section id="historyPage" class="p-6 max-w-4xl mx-auto hidden">
        <h2 class="text-2xl font-bold mb-6 text-gray-800">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</h2>
        <div id="historyList" class="space-y-4">
            </div>
    </section>

    <section id="statsPage" class="p-6 max-w-4xl mx-auto hidden">
        <div class="bg-purple-50 p-8 rounded-3xl text-center border-2 border-dashed border-purple-200">
            <h2 class="text-2xl font-bold text-purple-700">‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° PCSHS Dream</h2>
            <div id="summaryStats" class="mt-4 text-gray-600">
                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
            </div>
        </div>
    </section>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDEltidKLziMozc1j2luq2Tg53vexbcVIw",
        authDomain: "my-point-b913e.firebaseapp.com",
        projectId: "my-point-b913e",
        storageBucket: "my-point-b913e.firebasestorage.app",
        messagingSenderId: "350675489573",
        appId: "1:350675489573:web:1dbff25a03710071a640cc",
        databaseURL: "https://my-point-b913e-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- 1. Login Logic ---
    window.checkLogin = () => {
        const pass = document.getElementById('passInput').value;
        const authorizedUsers = ['18112012', '11072012'];
        
        if(authorizedUsers.includes(pass)) {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appContent').classList.remove('hidden');
            loadData();
        } else {
            Swal.fire({ icon: 'error', title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î', text: '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞!' });
        }
    };

    // --- 2. Navigation Logic ---
    window.showPage = (pageId) => {
        ['home', 'history', 'stats'].forEach(p => {
            document.getElementById(p + 'Page').classList.add('hidden');
            document.getElementById('btn-' + p).classList.remove('nav-active');
            document.getElementById('btn-' + p).classList.add('text-gray-400');
        });
        document.getElementById(pageId + 'Page').classList.remove('hidden');
        document.getElementById('btn-' + pageId).classList.add('nav-active');
        document.getElementById('btn-' + pageId).classList.remove('text-gray-400');
    };

    // --- 3. Data Entry & PCSHS Logic ---
    window.openModal = async (subject) => {
        const { value: formValues } = await Swal.fire({
            title: `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${subject}`,
            html:
                '<input id="sw-lesson" class="swal2-input" placeholder="‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">' +
                '<input id="sw-total" type="number" class="swal2-input" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î">' +
                '<input id="sw-score" type="number" class="swal2-input" placeholder="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ">',
            confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
            preConfirm: () => {
                const lesson = document.getElementById('sw-lesson').value;
                const total = parseFloat(document.getElementById('sw-total').value);
                const score = parseFloat(document.getElementById('sw-score').value);
                if (!lesson || isNaN(total) || isNaN(score)) {
                    Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                    return false;
                }
                return { subject, lesson, total, score, date: new Date().toLocaleString('th-TH') };
            }
        });

        if (formValues) {
            push(ref(db, 'records/'), formValues);
            
            const percent = (formValues.score / formValues.total) * 100;
            if (percent >= 50) {
                Swal.fire({
                    icon: 'success',
                    title: '‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏∞',
                    text: '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ PCSHS ‡∏°‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ üåü',
                    confirmButtonColor: '#10b981'
                });
            } else {
                Swal.fire({
                    icon: 'info',
                    title: '‡∏ó‡∏≥‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏∞',
                    text: 'PCSHS ‡∏£‡∏≠‡∏ô‡∏≤‡∏¢‡∏≠‡∏¢‡∏π‡πà ‡∏™‡∏π‡πâ‡πÄ‡∏Ç‡∏≤! üí™',
                    confirmButtonColor: '#3b82f6'
                });
            }
        }
    };

    // --- 4. Chart & Display Logic ---
    let myChart;
    function loadData() {
        onValue(ref(db, 'records/'), (snapshot) => {
            const data = snapshot.val();
            const historyList = document.getElementById('historyList');
            const summaryStats = document.getElementById('summaryStats');
            if(historyList) historyList.innerHTML = '';
            
            let chartScores = { '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': [], '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': [], '‡∏ß‡∏¥‡∏ä‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ': [] };
            let totalRecords = 0;

            if (data) {
                const entries = Object.values(data);
                totalRecords = entries.length;
                
                [...entries].reverse().forEach(item => {
                    if(historyList) {
                        historyList.innerHTML += `
                            <div class="bg-white p-5 rounded-2xl shadow-sm border-r-8 ${getColor(item.subject)}">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h4 class="font-bold text-gray-800">${item.subject}: ${item.lesson}</h4>
                                        <p class="text-xs text-gray-400">${item.date}</p>
                                    </div>
                                    <div class="text-xl font-bold">${item.score}/${item.total}</div>
                                </div>
                            </div>
                        `;
                    }
                    chartScores[item.subject].push((item.score/item.total)*100);
                });

                if(summaryStats) summaryStats.innerHTML = `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <b>${totalRecords}</b> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á <br> ‡∏™‡∏π‡πâ‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠ PCSHS!`;
                updateChart(chartScores);
            }
        });
    }

    function getColor(subj) {
        if(subj === '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå') return 'border-blue-400';
        if(subj === '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå') return 'border-rose-400';
        return 'border-emerald-400';
    }

    function updateChart(scores) {
        const canvas = document.getElementById('growthChart');
        if(!canvas) return;
        const ctx = canvas.getContext('2d');
        if (myChart) myChart.destroy();
        
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array.from({length: 5}, (_, i) => `‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${i+1}`),
                datasets: [
                    { label: '‡∏ß‡∏¥‡∏ó‡∏¢‡πå (%)', data: scores['‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'].slice(-5), borderColor: '#60a5fa', tension: 0.3, fill: false },
                    { label: '‡∏Ñ‡∏ì‡∏¥‡∏ï (%)', data: scores['‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'].slice(-5), borderColor: '#fb7185', tension: 0.3, fill: false },
                    { label: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ (%)', data: scores['‡∏ß‡∏¥‡∏ä‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ'].slice(-5), borderColor: '#34d399', tension: 0.3, fill: false }
                ]
            },
            options: { 
                maintainAspectRatio: false,
                scales: { y: { min: 0, max: 100 } },
                plugins: { legend: { labels: { usePointStyle: true, boxWidth: 6 } } }
            }
        });
    }
</script>

</body>
</html>

